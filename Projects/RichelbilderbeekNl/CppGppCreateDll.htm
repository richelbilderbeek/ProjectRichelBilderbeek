<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <title>Create a DLL using g++</title>
  <meta name="description" content="C++ Create a DLL using g++"/>
  <meta name="keywords" content="C++ Create a DLL using g++"/>
  <link rel="stylesheet" href="Richelbilderbeek.css" type="text/css"/>
</head>
<!-- End of head, start of body -->
<body>
<p><a href="index.htm">Go back to Richel Bilderbeek's homepage</a>.</p>
<p><a href="Cpp.htm">Go back to Richel Bilderbeek's C++ page</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<!-- Page header -->
<h1>(<a href="Cpp.htm">C++</a>) <a href="CppGppCreateDll.htm">Create a DLL using g++</a></h1>
<p>&nbsp;</p>
<p>Before being able to <a href="CppGppCallDll.htm">call a DLL</a>, one has to <a href="CppGppCreateDll.htm">create a DLL using g++</a> first.</p>
<p>&nbsp;</p>
<p>To create a <a href="CppGppDll.htm">DLL</a> using <a href="CppGpp.htm">g++</a>, do the following steps:</p>
<ul>
  <li>Create a <a href="CppDll.htm">DLL</a> entry point with a WinMain</li>
  <li>Create a unit with the functions you want to put in a <a href="CppDll.htm">DLL</a></li>
  <li>Build the <a href="CppDll.htm">DLL</a></li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>UnitEntryPoint.cpp</h2>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="UnitEntryPoint.cpp" border = "1"><tr><td><code>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<a href="CppInclude.htm">#include</a> &lt;windows.h&gt;<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<b><a href="CppInt.htm">int</a></b> WINAPI DllEntry<a href="CppPoint.htm">Point</a>(HINSTANCE hinst, <b><a href="CppUnsigned.htm">unsigned</a></b> <b><a href="CppLong.htm">long</a></b> reason, <b><a href="CppVoid.htm">void</a></b>* lpReserved)<br/>
{<br/>
&nbsp;&nbsp;<b><a href="CppReturn.htm">return</a></b> 1;<br/>
}<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<b><a href="CppInt.htm">int</a></b> WINAPI WinMain(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;HINSTANCE hInstance,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;HINSTANCE hPrevInstance,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;LPSTR lpCmdLine,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<b><a href="CppInt.htm">int</a></b> nCmdShow)<br/>
{&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<b><a href="CppReturn.htm">return</a></b> 0;<br/>
}<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>UnitFunctions.h</h2>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="UnitFunctions.h" border = "1"><tr><td><code>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<a href="CppIfndef.htm">#ifndef</a> Unit<a href="CppFunction.htm">Function</a>sH<br/>
<a href="CppDefine.htm">#define</a> Unit<a href="CppFunction.htm">Function</a>sH<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<a href="CppIfdef.htm">#ifdef</a> __cplusplus<br/>
<b><a href="CppExtern.htm">extern</a></b> "C"<br/>
{<br/>
<a href="CppEndif.htm">#endif</a><br/>
<br/>
__declspec (dll<b><a href="CppExport.htm">export</a></b>) <b><a href="CppConst.htm">const</a></b> <b><a href="CppInt.htm">int</a></b> GetAnswerOfLife();<br/>
<br/>
<a href="CppIfdef.htm">#ifdef</a> __cplusplus<br/>
}<br/>
<a href="CppEndif.htm">#endif</a><br/>
<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<a href="CppEndif.htm">#endif</a><br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>The function put in the DLL is called GetAnswerOfLife and will return the value of
42. Note the <a href="CppIfdef.htm">#ifdef</a>'s before and after the function.
These are obligatory!</p>
<p>&nbsp;</p>
<p>Now the function GetAnswerOfLife must be defined in UnitFunctions.cpp. Upon viewing
it, the code looks like below</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>UnitFunctions.cpp</h2>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="UnitFunctions.cpp" border = "1"><tr><td><code>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<a href="CppInclude.htm">#include</a> "Unit<a href="CppFunction.htm">Function</a>s.h"<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
<b><a href="CppConst.htm">const</a></b> <b><a href="CppInt.htm">int</a></b> GetAnswerOfLife()<br/>
{<br/>
&nbsp;&nbsp;<b><a href="CppReturn.htm">return</a></b> 42;<br/>
}<br/>
<a href="CppComment.htm">//</a>---------------------------------------------------------------------------<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Building the DLL</h2>
<p>&nbsp;</p>
<p>Use the following <a href="CppGpp.htm">g++</a> commands:</p>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="Building the DLL with g++ commands" border = "1"><tr><td><code>
<a href="CppGpp.htm">g++</a> -c UnitFunctions.cpp<br/>
<a href="CppGpp.htm">g++</a> -c UnitEntryPoint.cpp<br/>
<a href="CppGpp.htm">g++</a> -o Functions.dll UnitEntryPoint.o UnitFunctions.o<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>This should yield your first <a href="CppDll.htm">DLL</a>.</p>
<p>&nbsp;</p>
<p>Perhaps you now want to <a href="CppGppCallDll.htm">go to the calling a DLL page using g++</a>.</p>
<p>&nbsp;</p>
<p><a href="CppGppCreateDll.zip">Or download all source code of this page at once</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="Cpp.htm">Go back to Richel Bilderbeek's C++ page</a>.</p>
<p><a href="index.htm">Go back to Richel Bilderbeek's homepage</a>.</p>
<p>&nbsp;</p>
<p><a href="http://validator.w3.org/check?uri=referer"><img src="valid-xhtml10.png" alt="Valid XHTML 1.0 Strict" height="31" width="88" /></a></p>
</body>
</html>
